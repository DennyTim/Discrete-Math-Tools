<!DOCTYPE html>
<html>
<head>
<title>Roots of polynomials composite moduli</title>
</head>
<body style="text-align: center">

<p>Composite moduli</p>

<form id="frm" onsubmit="compModuli()">
    <div id="input_polynomial">
        (<input type="text" class="coeff">*x2 - <input type="text" class="root">) * (x1 - <input type="coeff" class="root">) = 0 (mod <input type="text" id="moduli">)<br>
    </div>
    <input type="submit" value="Submit">
</form>

<button onclick="addElement()">Add</button>
    <script>
    function compModuli(){
        var coefficients = document.getElementsByClassName("coeff");
        var remainders = document.getElementsByClassName("root");
        var moduli = document.getElementById("moduli");
        
        var divisors = factorization(moduli)
        
        var matches = [[]]
        
        var level = divisors.length

        var id = []
        
        for(i = 0; i < coefficients.length; i++){
            id.push(i);
        }
        
        ids = permutation(id, level, []);
        
        var solution_list = [];

        for(i = 0; i < ids.length; i++){
            var c = [];
            var r = [];
            for(j = 0; j < ids[i].length; j++){
                c.push(coefficients[ids[i]]);
                r.push(remainders[ids[i]]);
                
            }
            
            var decoeff_r = []

            for(j = 0; j < r.length; j++){
                decoeff_r[j] = de_coefficient(c[j], r[j], divisors[j]);
            }

            solution_list.push.apply(simultaneous_congruences(decoeff_r, divisors));

        }

    }

    //return a 2d array  chooseFrom 
    function permutation(choose_from, level, list){
        if(level !== 1){
            var lst = [];
            for(var i = 0; i < choose_from.length; i++){
                var temp = list.concat();
                temp.push(choose_from[i]);

                var temp_choose_from = [];

                for(var k = 0; k < choose_from.length; k++){
                    if(k != i){
                        temp_choose_from.push(choose_from[k]);
                    }
                }

                lst.push.apply(lst, permutation(temp_choose_from, level - 1, temp));
            }
            
            return lst;

        }
        var lst = [];
        for(var i = 0; i < choose_from.length; i++){
            var temp = list.concat();
            temp.push(choose_from[i]);
            lst.push(temp);
        }
        return lst;
    }

    

    function addElement(){
        $( "#input_polynomial" ).prepend( "(<input type='text' class='coeff'>*x1 - <input type='text' class='root'>)" );
    }

    function factorization(num){
        var f = 2;
        var a = new Set([]);
        
        while(num % 2 == 0){
            a.add(2);
            num /= 2;
        }

        f = 3;
        
        while(f * f < num){
            while(num % f == 0){
                a.add(f);
                num /= f;
            }
            f += 2;
        }

        if(num != 0){
            a.add(num);
        }
        
        return a;
    }

    function simultaneous_congruences(remainders, modulus){
        var product = 1;
        for(i = 0; i < modulus.length; i++){
            product *= modulus[i];
        }
        
        var multipliers = []

        for(i = 0; i < remainders.length; i++){
            var prod = product / modulus[i];
            multipliers[i] = 1;
            while((multipliers[i] * prod) % modulus[i] != remainders[i]){
                multipliers[i] = multipliers[i] + 1;
            }
        }
        
        var con = 0;

        for(i = 0; i < multipliers.length; i++){
            con += multipliers[i] * (product / modulus[i]);
        }

        return [con, product];
    }

    function gcd(a, b){

        while (true) {
            if(a > b){
                a %= b;
            }else{
                b %= a;
            }
            if(a == 0 || b == 0){
                 return (a == 0) ? b : a;
            }
        }
    }

    function de_coefficient(coef, remainder, divisor){
        while(remainder % coef != 0){
            remainder += divisor;
        }
        return remainder / coef;
    }
    
    </script>

</body>
</html>